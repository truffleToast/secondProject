<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri = "http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri = "http://java.sun.com/jsp/jstl/fmt" %>
<% response.addHeader("Access-Control-Allow-Origin", "*"); %>
<% response.setHeader("Access-Control-Allow-Headers", "orgin, x-requested-with, content-type, accept"); %>
<c:set var ="cpath" value ="${pageContext.request.contextPath}"/>

<!DOCTYPE html>
<html>
<head>
    <title>ìŠ¤ì¼€ì¹˜ íŒ¨ë“œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.1/fabric.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>    
    
    <style>
body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
}

#canvas-container {
    /* border: 1px solid #ccc; */
    margin-bottom: 20px;
    margin-top: 150px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.25); 
    border-radius: 5px
}
#image-container {
    display: flex;
    overflow-x: auto;
    
}

#bg-container {
    display: flex;
    overflow-x: auto;
    
}
#start-drawing-button img, #prev-button img , #next-button img , #reset-button img,
#photo-upload-button img, #bg-upload-button img, #text-button img 
{
    max-width: 1.9rem; /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì ˆ */
    /* max-height: 30px; */
}




/* ìƒë‹¨ë°” css */

/* .div-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
  max-width: 100%;
  /* max-height: 100%;
  heigth: auto;  
  background-color: #fffefd;
} */

.view {
  position: absolute;
  /* width: 1920px; */
  width: 100%;
  height: 96px;
  top: 0;
  left: 0;
}

.overlap {
  position: relative;
  width: 100%;
  height: 100%;
}

.group {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
}

.overlap-group {
  position: relative;
  width: 100%;
  height: 100%;
  background-color: #fffefd;
  box-shadow: 0px 2px 12px #0000001a;
}

.text-wrapper {
  position: absolute;
  top: 19px;
  left: 60px;
  font-family: "Noto Sans CJK KR-Bold", Helvetica;
  font-weight: 700;
  color: #242424;
  font-size: 40px;
  letter-spacing: 0;
  line-height: normal;
  text-decoration: underline;
}

#head-div .div {
  position: absolute;
  top: 34px;
  left: 259px;
  font-family: "AppleSDGothicNeoB00-Regular", Helvetica;
  font-weight: 400;
  color: #898989;
  font-size: 20px;
  letter-spacing: 0;
  line-height: normal;
}

.text-wrapper-2 {
  position: absolute;
  top: 34px;
  left: 499px;
  font-family: "AppleSDGothicNeoM00-Regular", Helvetica;
  font-weight: 400;
  color: #fba21d;
  font-size: 20px;
  letter-spacing: 0;
  line-height: normal;
}

.line {
  position: absolute;
  width: 1px;
  height: 20px;
  top: 39px;
  left: 479px;
  object-fit: cover;
}

.group-wrapper {
  position: absolute;
  width: 142px;
  height: 48px;
  top: 24px;
  left: 1718px;
  background-color: #fba21d;
  border-radius: 12px;
  box-shadow: 0px 0px 8px #0000001a;
}

.group-2 {
  position: relative;
  width: 66px;
  height: 24px;
  top: 12px;
  left: 39px;
}

#head-div .img {
  position: absolute;
  width: 24px;
  height: 24px;
  top: 0;
  left: 0;
}

.text-wrapper-3 {
  position: absolute;
  top: 2px;
  left: 38px;
  font-family: "Noto Sans CJK KR-Bold", Helvetica;
  font-weight: 700;
  color: #ffffff;
  font-size: 14px;
  text-align: center;
  letter-spacing: 0;
  line-height: normal;
}

.group-3 {
  position: absolute;
  width: 155px;
  height: 48px;
  top: 24px;
  left: 1369px;
  background-color: #fffffd;
  border-radius: 12px;
  box-shadow: 0px 0px 8px #0000001a;
}

.group-4 {
  position: relative;
  width: 92px;
  height: 24px;
  top: 12px;
  left: 32px;
}

.text-wrapper-4 {
  position: absolute;
  top: 2px;
  left: 38px;
  font-family: "Noto Sans CJK KR-Bold", Helvetica;
  font-weight: 700;
  color: #363636;
  font-size: 14px;
  text-align: center;
  letter-spacing: 0;
  line-height: normal;
}

.group-5 {
  position: absolute;
  width: 154px;
  height: 48px;
  top: 24px;
  left: 1544px;
  background-color: #fffffd;
  border-radius: 12px;
  box-shadow: 0px 0px 8px #0000001a;
}

.group-6 {
  position: relative;
  width: 105px;
  height: 24px;
  top: 12px;
  left: 25px;
}




/* í¸ì§‘ íˆ´ css */
button#start-drawing-button,
button#prev-button,
button#next-button,
button#reset-button,
button#text-button {
	border: 0px;
	background-color: white;
	margin: 0 1em;
}

div#edit-tool {
	text-align: center;
}

.drwaing-tool {
	display: flex;
	flex-direction: row;
	justify-content: center;
	margin-top: 1.5em;
	margin-bottom: 1.5em;
}

.line-color-div{
	margin-right: 1em;
}

.line-width-div{
	margin-left: 1em;
}

/*AI ì´ë¯¸ì§€ ì œê±° MODAL*/

.imageEdit-modal{
	display:flex;
	align-items: center;
	width: 33%;
}



</style>
</head>
<body>

   
    <header id="head-div">    
	      <div class="view">
	        <div class="overlap">
	          <div class="group">
	            <div class="overlap-group">
	              <div class="text-wrapper"><a href="${cpath}//">D.A.Y</a></div>
	              <div class="div">ì‹œì¦Œì´ ì§€ë‚˜ê³  ë‚˜ë“¤ì´ ğŸ™„</div>
	              <div class="text-wrapper-2">16:9 1920px*1080px</div>
	              <img class="line" src="img/line-21.svg" />
	            </div>
	          </div>
	          <div class="group-wrapper">
	            <div class="group-2">
	              <img class="img" src="img/image.svg" />
	              <div class="text-wrapper-3">ë“±ë¡</div>
	            </div>
	          </div>
	          <button class="group-3" id="save-jpg-button">
	            <div class="group-4">
	              <img class="img" src="img/glyph-undefined.svg" />
	              <div class="text-wrapper-4">ë‚´ë³´ë‚´ê¸°</div>
	            </div>
	          </button>
	          <div class="group-5">
	            <div class="group-6">
	              <img class="img" src="img/glyph-undefined-3.svg" />
	              <div class="text-wrapper-4">ì„ì‹œì €ì¥í•¨</div>
	            </div>
	          </div>
	        </div>
	      </div>
      </header>
      






<div id="canvas-container">
  <canvas id="main-canvas" width="1000" height="600"></canvas>
</div>




<div class="container">
  
  <br>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs justify-content-center" role="tablist">
    <li class="nav-item">
      <a class="nav-link active text-danger font-weight-bold" data-toggle="tab" href="#home">ì‚¬ì§„</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-warning font-weight-bold" data-toggle="tab" href="#menu1">ë°°ê²½</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-info font-weight-bold" data-toggle="tab" href="#menu2">ìŠ¤í‹°ì»¤</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-success font-weight-bold" data-toggle="tab" href="#menu3">ê·¸ë¦¬ê¸°</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-primary font-weight-bold" data-toggle="tab" href="#menu4">A.I</a>
    </li>
  </ul>

  <!-- Tab panes -->
  
  
  <div class="tab-content">
    <div id="home" class="container tab-pane active"><br>
      	<div id="image-container">
      	    <div id="photo-upload-button">
		      <img class="add-undefined-glyph" src="img/glyph-undefined.svg" alt="ì—…ë¡œë“œ" />
		      <div class="text-wrapper">ì‚¬ì§„<br />ê°€ì ¸ì˜¤ê¸°</div>
		    </div>
<%--     		<div id="photo-upload-button">
			  <img src="${cpath}/resources/editor/upload.png" alt="ì—…ë¡œë“œ"><h5>ì—…ë¡œë“œ</h5>
			</div> --%>
    		<input type="file" id="image-upload" multiple="multiple" accept="image/*" style= "display: none;">	
  		</div>
    </div>
    <div id="menu1" class="container tab-pane fade"><br>
	   
	   <div id="bg-container">
	    	<div id="bg-upload-button">
			  <img src="${cpath}/resources/editor/upload.png" alt="ì—…ë¡œë“œ"><h5>ì—…ë¡œë“œ</h5>
			</div>
	    <input type="file" id="background-upload" multiple="multiple" accept="image/*" style= "display: none;">
	    	
	  </div>
    </div>
    
    
    <div id="menu2" class="container tab-pane fade"><br>
      <h3>ìŠ¤í‹°ì»¤</h3>
      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
    </div>
    <div id="menu3" class="container tab-pane fade"><br>
      <div id="edit-tool">
		  <button id="prev-button">
		    <img src="${cpath}/resources/editor/prev.png" alt="ì´ì „ìœ¼ë¡œ">
		  </button>
		  <button id="next-button">
		    <img src="${cpath}/resources/editor/next.png" alt="ë‹¤ìŒìœ¼ë¡œ">
		  </button>
		  <button id="reset-button">
		    <img src="${cpath}/resources/editor/reset.png" alt="ì´ˆê¸°í™”">
		  </button>
	      <button id="start-drawing-button">
		    <img src="${cpath}/resources/editor/pencil.png" alt="ê·¸ë¦¬ê¸° ëª¨ë“œ ì‹œì‘">
		  </button>
		  <button id="text-button">
		    <img src="${cpath}/resources/editor/txt.png" alt="í…ìŠ¤íŠ¸">
		  </button>
		  
		  <div class="collapse" id="drawing-options">
		  	<div class="drwaing-tool">
			  <div class="line-color-div"><input type="color" id="line-color" value="#000000"></div>
			  <div class="line-width-div"><input type="range" id="line-width" min="1" max="10" value="2"></div>
			  <div class="controls__btns">
				  <button id="jsErase">ì§€ìš°ê°œ</button>
				  <input type="range" id="jsRange" min="0.1" max="20.0" step="0.1"/>
			  </div>
		  	</div>
		  </div>
		  
<!-- 		  <label for="font-family">ê¸€ê¼´ ì„ íƒ:</label>
		    <select id="font-family">
		        <option value="Arial">Arial</option>
		        <option value="Times New Roman">Times New Roman</option>
		        <option value="Courier New">Courier New</option>
		        <option value="Georgia">Georgia</option>
		    </select> -->
      </div>    
    </div>
    <div id="menu4" class="container tab-pane fade"><br>
      <h3>A.I</h3>
      <h3>ë°°ê²½ ì œê±°, ì´ë¯¸ì§€ ìƒì„±, AI ì§€ìš°ê°œ ë“±ì„ ì²´í—˜í•´ë³´ì„¸ìš”</h3>
      <button id="ai-edit__btn">AIê¸°ëŠ¥ ì‚¬ìš©í•˜ê¸°</button>
      
    
         
         
         
<div class ="imageEdit-modal__wrap">
	 <!-- ì´ë¯¸ì§€ í¸ì§‘ í”Œë¼ìŠ¤í¬ -->
       <div class="ai-imgEdit">
      <!-- removeBg -->
         <div class="imageEdit-removeBg">
            <span class="imageEdit-removeBg__span">ë°°ê²½ ì œê±°</span>
            <form id="imageEdit-removeBg__form" 
            method= "post" enctype ="multipart/form-data">
               <input type ="file" name ="myfile" id="uploadFile_notEdited">
               <input type ="submit" id="imageEdit-removeBg__sub" value="ë°°ê²½ì œê±°í•˜ê¸°">
            </form>
         </div>
      <!-- imageGenerator ìƒì„±(Kalo)-->
         <div class="imageEdit-makeImg">
            <span class ="imageEdit-makeImg__span">ì´ë¯¸ì§€ ìƒì„±</span>
            	<form id ="imageEdit-makeImg__form" method ="post">
               <h6>êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì—¬ ì£¼ì‹œê³ , ì˜ì–´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”</h6>
               <input type ="text" name ="prompt" placeholder="ìƒì„±í•  ì´ë¯¸ì§€ì˜ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"><!-- ìƒì„±í•  ì´ë¯¸ì§€ í…ìŠ¤íŠ¸ --><br>
               <span class ="makeImg-style">ì›í•˜ëŠ” ìŠ¤íƒ€ì¼</span>
               <select name="art_style" id="art_style">
                  <option value="">ì„ íƒ ì•ˆí•¨</option>
                  <option value="by Renoir">ë¥´ëˆ„ì•„ë¥´ ìŠ¤íƒ€ì¼</option>
                  <option value="by Picasso">í”¼ì¹´ì†Œ ìŠ¤íƒ€ì¼</option>
                  <option value="by Gogh">ê³ í ìŠ¤íƒ€ì¼</option>
                  <option value="Anime">ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼</option>
                  <option value="cartoon">ì¹´íˆ° ìŠ¤íƒ€ì¼</option>
               </select>
               <br>
               <input type ="text" name ="negative_prompt"> <!-- ì´ë¯¸ì§€ì—ì„œ ìƒì„±í•˜ê³  ì‹¶ì§€ ì•Šì€ ìš”ì†Œ -->
               <span>- ìƒì„±ì‹œ ì œê±°í•  ìš”ì†Œ</span>
               <input type ="submit" id="imageEdit-makeImg__sub" value="ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°">
            	</form>
         	</div>
         </div>
	<div class= "imageEdit-modal imageEdit-modal__removeBg">
	   <img id= "basic_image__remBg" src="" alt="ê¸°ë³¸ ì´ë¯¸ì§€"> <!--í°ìƒ‰ë§Œ ìˆê±°ë‚˜ íˆ¬ëª…í•œ ì´ë¯¸ì§€ í•˜ë‚˜ê°€ì ¸ì™€ì„œ ë„ìš°ê¸°-->
	   <span>ë°°ê²½ ì œê±° ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</span>
	</div>
	<div class ="imageEdit-modal imageEdit-modal__makedImg">
	   <img id= "basic_image__makeImg" src="" alt="ê¸°ë³¸ ì´ë¯¸ì§€"> <!--í°ìƒ‰ë§Œ ìˆê±°ë‚˜ íˆ¬ëª…í•œ ì´ë¯¸ì§€ í•˜ë‚˜ê°€ì ¸ì™€ì„œ ë„ìš°ê¸°-->
	   <span>ë§Œë“¤ì–´ì§„ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</span> 
	</div>
	
	<div class= "imageEdit-modal imageEdit-modal__aiEraser">
	   <!-- ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ input íƒœê·¸ ì¶”ê°€ -->
	   <input type="file" id="imageUpload" accept="image/*">
	   <img id="modal-userImg__unerased" src="${cpath}/resources/img/header-bg.jpg" onclick= "findPoint(event)" style="display: none;">
	</div>
</div>
         
         
    </div>
  </div>
</div>




<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
<script>


//ajax ë¶€ë¶„
$(document).ready(function(){
    // ì´ë¯¸ì§€ ë°°ê²½ ì œê±° ê¸°ëŠ¥ ì²˜ë¦¬
    $("#imageEdit-removeBg__form").on('submit',function(e){	
        e.preventDefault(); // í¼ ì œì¶œ ê¸°ë³¸ ì´ë²¤íŠ¸ ë°©ì§€
        var removeBg_fData = new FormData(this); // í¼ ë°ì´í„° ìƒì„±	        
      	console.log(removeBg_fData); 
      	//ì´ë¯¸ì§€ ì—…ë¡œë“œ í›„ í™”ë©´ì— ë³´ì´ê²Œ í•˜ê¸°
    $("#uploadFile_notEdited").change(function(){
       var reader = new FileReader();
       reader.onload = function(e){
        UnerasedImg.attr('src', e.target.result).show();
        }
       reader.readAsDataURL(this.files[0]);
    	});
    });
   
      
      
      	
        // AJAX ìš”ì²­ ì„¤ì • ë° ì „ì†¡
        $.ajax({
            url:'http://localhost:5000/removeBg', // ìš”ì²­ URL
            type: "post", // HTTP ìš”ì²­ ë°©ì‹
            encytpe: "multipart/form-data",
            cache:false,
            data: removeBg_fData, // ì „ì†¡í•  ë°ì´í„°
            contentType: false, // ì»¨í…íŠ¸ íƒ€ì… ì„¤ì • ë°©ì§€
            processData: false, // ë°ì´í„°ë¥¼ ì¿¼ë¦¬ ë¬¸ìì—´ë¡œ ë³€í™˜ ë°©ì§€
            success: function(data) { // ìš”ì²­ ì„±ê³µ ì‹œ ì²˜ë¦¬í•  í•¨ìˆ˜
                uploadRemovedImg(data);// ë°°ê²½ì´ ì œê±°ëœ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ
            },
            error: function(xhr, status, error){ // ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬í•  í•¨ìˆ˜
                alert('Error: ' + error); // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            }
        });
    });

    // í…ìŠ¤íŠ¸ ê¸°ë°˜ ì´ë¯¸ì§€ ìƒì„± ê¸°ëŠ¥ ì²˜ë¦¬
    $("#imageEdit-makeImg__form").on('submit',function(e){
        e.preventDefault(); // í¼ ì œì¶œ ê¸°ë³¸ ì´ë²¤íŠ¸ ë°©ì§€
        var promptValue = $("input[name='prompt']").val(); // nameì´ promptì¸ input
        var styleValue = $("#art_style option:selected").val(); //artìŠ¤íƒ€ì¼ì—ì„œ ì„ íƒëœ ê²ƒì˜ ë°¸ë¥˜
        //ì‚¼í•­ì—°ì‚°ìë¡œ ì²˜ë¦¬
        var combinedPrompt = promptValue + (styleValue ? ", " + styleValue : "");
        
        var makeImg_fData = new FormData(this);
        makeImg_fData.set("prompt", combinedPrompt); // ë³´ë‚¼ ê°ì²´ë¥¼ ì € ê²°í•©í•œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì²˜ë¦¬

        // AJAX ìš”ì²­ ì„¤ì • ë° ì „ì†¡
        $.ajax({
            url:'http://localhost:5000/makeImg', // ìš”ì²­ URL
            type: "post", // HTTP ìš”ì²­ ë°©ì‹
            data: makeImg_fData, // ì „ì†¡í•  ë°ì´í„°
            contentType: false, // ì»¨í…íŠ¸ íƒ€ì… ì„¤ì • ë°©ì§€
            processData: false, // ë°ì´í„°ë¥¼ ì¿¼ë¦¬ ë¬¸ìì—´ë¡œ ë³€í™˜ ë°©ì§€
            
            success: function(data){ 
            	uploadMakedImg(data)
            },
            error: function(xhr, status, error){ // ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬í•  í•¨ìˆ˜
                alert('Error: ' + error); // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            }
        });
    });
   // AI ì§€ìš°ê°œ ê¸°ëŠ¥
      var UnerasedImg = $("#modal-userImg__unerased") // UnerasedImgëŠ” ìœ ì €ê°€ ì˜¬ë¦° ì‚¬ì§„
      var clickX, clickY; // í´ë¦­ ìœ„ì¹˜ ì €ì¥ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜
      
     
      //ì´ë¯¸ì§€ ì—…ë¡œë“œ í›„ í™”ë©´ì— ë³´ì´ê²Œ í•˜ê¸°
      $("#imageUpload").change(function(){
        var reader = new FileReader();
        reader.onload = function(e){
            UnerasedImg.attr('src', e.target.result).show();
        }
        reader.readAsDataURL(this.files[0]);
    });
      
      // ì´ë¯¸ì§€ì™€ ìœ„ì¹˜ ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡
      $(#"imageEdit-removeBg__form").on("submit",function(e){
    	  e.preventDefault(); // í¼ ì œì¶œ ê¸°ë³¸ ì´ë²¤íŠ¸ ë°©ì§€
      	var formData = new FormData(this);
        formData.append('image', $("#imageUpload")[0].files[0]);
        formData.append('x', clickX);
        formData.append('y', clickY);
        $.ajax({   
            url:"http://localhost:5000/remove_object", //ìš”ì²­ url remove_objectìœ¼ë¡œ ë³´ë‚´ê³ 
            type: "post",
            encytpe: "multipart/form-data",
            data: formData,
            processData: false,
            contentType: false,
            success: function(data){
           	 uploadErasedImg(data);
            },
            error: alert("Error")
            
         });
        
      });

});

// ë°°ê²½ì´ ì œê±°ëœ ì´ë¯¸ì§€ë¥¼ ëª¨ë‹¬ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
function uploadRemovedImg(data){
   console.log(data)
   var imageUrl = data.image_url;
    $(".imageEdit-modal__removeBg").append('<img id="bg-removedImg" src="'+imageUrl+'" />');
}

// ìƒì„±ëœ ì´ë¯¸ì§€ë¥¼ ëª¨ë‹¬ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ -> ê¸°ë³¸ ì´ë¯¸ì§€ì˜ hrefë¥¼ ë°”ê¿”ì£¼ê¸°
function uploadMakedImg(data){
   	console.log(data);   
    var makedImg = data.image_url; //image_urlë¡œ í• ê²ƒ
    console.log(makedImg); //ì´ë¯¸ì§€ url í™•ì¸
    $('#basic_image__makeImg').attr('src', makedImg); //src ë³€ê²½í•˜ê¸°

}
function uploadErasedImg(data){	
	var erasedImg = data.image_url;
	console.log(erasedImg); // ì´ë¯¸ì§€ urlë³´ë‚¼ê²ƒ ì—¬ê¸°ì„  ìë°” ì ˆëŒ€ ê²½ë¡œ;
	$('#basic_image_') //TODO
	
}






document.addEventListener('DOMContentLoaded', function () {
	  const canvas = new fabric.Canvas('main-canvas');	  
	  const ctx = canvas.getContext("2d");
	  var imageContainer = document.getElementById('image-container');
	  var uploadInput = document.getElementById('image-upload');
	  var propertiesPanel = document.getElementById('properties-panel'); // í¸ì§‘ ì˜µì…˜ì„ ë‹´ì€ íŒ¨ë„ì˜ ID
	  var photoButton = document.getElementById('photo-button');
	  var backgroundButton = document.getElementById('background-button');
	  var bgContainer = document.getElementById('bg-container');
	  var bgUploadInput = document.getElementById('background-upload');
	  var isDrawingMode = false;
	  var undoStack = [];
	  var redoStack = [];
	  var prevButton = document.getElementById('prev-button');
	  var nextButton = document.getElementById('next-button'); // ë‹¤ìŒ ë²„íŠ¼ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
	  var textButton = document.getElementById('text-button'); // í…ìŠ¤íŠ¸ ë²„íŠ¼ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
	  var isTextMode = false; // í…ìŠ¤íŠ¸ ëª¨ë“œ ìƒíƒœ ë³€ìˆ˜
	  var activeText = null;
	  
	  // ì§€ìš°ê°œ
	  const erase = document.getElementById("jsErase");
	  const erase_range = document.getElementById("jsRange");
	  
	
	  
	  
	// í…ìŠ¤íŠ¸ ë„êµ¬ í™œì„±í™” í•¨ìˆ˜
	  function enableTextMode() {
	      isTextMode = true;
	      canvas.discardActiveObject(); // ì„ íƒëœ ê°ì²´ ì·¨ì†Œ
	      canvas.requestRenderAll();
	      activeText = null; // ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ ìƒì ìƒì„±ì„ ìœ„í•´ activeText ì´ˆê¸°í™”
	  }

	  // í…ìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
	  textButton.addEventListener('click', function () {
	      enableTextMode();
	  });

	  // ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
	  canvas.on('mouse:down', function (options) {
    if (isTextMode) {
        var pointer = canvas.getPointer(options.e);
        if (!activeText) {
            // í™œì„±í™”ëœ í…ìŠ¤íŠ¸ ìƒìê°€ ì—†ì„ ë•Œë§Œ ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ ìƒì ìƒì„±
            activeText = new fabric.Textbox('í…ìŠ¤íŠ¸ ì…ë ¥', {
                left: pointer.x,
                top: pointer.y,
                fontFamily: 'Arial',
                fill: 'black',
            });
            canvas.add(activeText);
            canvas.setActiveObject(activeText);
            canvas.requestRenderAll();
        }
    } else {
        // í…ìŠ¤íŠ¸ ëª¨ë“œê°€ ì•„ë‹ ë•Œ, ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰
    }
    
    // í…ìŠ¤íŠ¸ ëª¨ë“œ ë¹„í™œì„±í™”
    disableTextMode();
});

	  // í…ìŠ¤íŠ¸ ì…ë ¥ ëª¨ë“œ ë¹„í™œì„±í™” í•¨ìˆ˜
	  function disableTextMode() {
	      isTextMode = false;
	      activeText = null; // í™œì„±í™”ëœ í…ìŠ¤íŠ¸ ìƒì ì´ˆê¸°í™”
	  }

	  // ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬: í…ìŠ¤íŠ¸ ëª¨ë“œ ë¹„í™œì„±í™”
	  canvas.on('mouse:down', function () {
	      disableTextMode();
	  });
	      
/* 	// ê¸€ê¼´ ì„ íƒë€ ì—˜ë¦¬ë¨¼íŠ¸ì™€ í…ìŠ¤íŠ¸ë¥¼ ë³€ê²½í•  ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
	  const fontSelect = document.getElementById('font-family');

	  // ê¸€ê¼´ ì„ íƒë€ì˜ ë³€ê²½ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•©ë‹ˆë‹¤.
	  fontSelect.addEventListener('change', function () {
	      if (isTextMode && activeText) {
	          // ì„ íƒí•œ ê¸€ê¼´ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
	          const selectedFont = fontSelect.value;

	          // í™œì„±í™”ëœ í…ìŠ¤íŠ¸ ìƒìì— ì„ íƒí•œ ê¸€ê¼´ì„ ì ìš©í•©ë‹ˆë‹¤.
	          activeText.set({ fontFamily: selectedFont });
	          canvas.requestRenderAll();
	      }
	  }); */

		
	  
	// ì‚¬ìš©ì ì •ì˜ ì´ë¯¸ì§€ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
	  document.getElementById('photo-upload-button').addEventListener('click', function () {
	      // íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­
	      document.getElementById('image-upload').click();
	  });
	  document.getElementById('bg-upload-button').addEventListener('click', function () {
	      // íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­
	      document.getElementById('background-upload').click();
	  });
	  
	  
	  // ì´ë¯¸ì§€ë¥¼ Canvasì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
	  function addImageToCanvas(imgElement) {
	    fabric.Image.fromURL(imgElement.src, function (oImg) {
	      canvas.add(oImg).renderAll();
	      // ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ í¸ì§‘ ì˜µì…˜ íŒ¨ë„ì„ í‘œì‹œ
	      propertiesPanel.style.display = 'block';
	      // ì„ íƒëœ ê°ì²´ì˜ ì†ì„±ì„ íŒ¨ë„ì— í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
	      // ì˜ˆ: propertiesPanel.querySelector('.width').textContent = oImg.getScaledWidth();
	    });
	  }
		//ë°°ê²½ì´ë¯¸ì§€ë¡œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
		function setCanvasBackground(imgElement) {
			var img = new Image();
		    img.src = imgElement.src;

		    img.onload = function () {
		        canvas.setBackgroundImage(imgElement.src, canvas.renderAll.bind(canvas), {
		            scaleX: canvas.width / img.width,
		            scaleY: canvas.height / img.height,
		            top: 0,
		            left: 0
		        });
		    };
		}
		// ì´ì „ìœ¼ë¡œ ëŒì•„ê°€ëŠ” í•¨ìˆ˜
		function undo() {
		    if (undoStack.length > 0) {
		        var previousState = undoStack.pop(); // ìŠ¤íƒì—ì„œ ì´ì „ ìƒíƒœë¥¼ íŒ
		        redoStack.push(JSON.stringify(canvas.toDatalessJSON())); // í˜„ì¬ ìƒíƒœë¥¼ ë‹¤ìŒ í–‰ë™ ìŠ¤íƒì— ì €ì¥
		        canvas.loadFromJSON(previousState); // ì´ì „ ìƒíƒœë¡œ canvas ë³µì›
		        canvas.renderAll(); // canvas ë‹¤ì‹œ ê·¸ë¦¬ê¸°
		    }
		    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
		    updateButtonState();
		}

		// ë‹¤ìŒìœ¼ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
		function redo() {
		    if (redoStack.length > 0) {
		        var nextState = redoStack.pop(); // ìŠ¤íƒì—ì„œ ë‹¤ìŒ ìƒíƒœë¥¼ íŒ
		        undoStack.push(JSON.stringify(canvas.toDatalessJSON())); // í˜„ì¬ ìƒíƒœë¥¼ ì´ì „ í–‰ë™ ìŠ¤íƒì— ì €ì¥
		        canvas.loadFromJSON(nextState); // ë‹¤ìŒ ìƒíƒœë¡œ canvas ë³µì›
		        canvas.renderAll(); // canvas ë‹¤ì‹œ ê·¸ë¦¬ê¸°
		    }
		    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
		    updateButtonState();
		}

		
		
	  
		bgContainer.addEventListener('click', function (e) {
		    var clickedImage = e.target;
		    // í´ë¦­í•œ ì´ë¯¸ì§€ë¥¼ canvasì˜ ë°°ê²½ìœ¼ë¡œ ì„¤ì •
		    setCanvasBackground(clickedImage);
		});

		// ì´ë¯¸ì§€ë¥¼ Canvasì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ (ì´ë¯¸ì§€ ì¶”ê°€ì™€ ë°°ê²½ ì„¤ì •ì„ ë¶„ë¦¬)
		function addImageToCanvas(imgElement) {
		    fabric.Image.fromURL(imgElement.src, function (oImg) {
		        canvas.add(oImg).renderAll();
		        // ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ í¸ì§‘ ì˜µì…˜ íŒ¨ë„ì„ í‘œì‹œ
		        propertiesPanel.style.display = 'block';
		        // ì„ íƒëœ ê°ì²´ì˜ ì†ì„±ì„ íŒ¨ë„ì— í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		        // ì˜ˆ: propertiesPanel.querySelector('.width').textContent = oImg.getScaledWidth();
		    });
		}

		
		
	  uploadInput.addEventListener('change', function (e) {
	    var files = e.target.files;
	   

	    for (var i = 0; i < files.length; i++) {
	      (function (file) {
	        var reader = new FileReader();
	        reader.onload = function (e) {
	          var img = new Image();
	          img.src = e.target.result;
	          img.style.maxHeight = '100px';
	          img.onclick = function () {
	            // ì´ë¯¸ì§€ í´ë¦­ ì‹œ Canvasì— ì¶”ê°€
	            addImageToCanvas(img);
	          };
	          imageContainer.appendChild(img);
	        };
	        reader.readAsDataURL(file);
	      })(files[i]);
	    }
	  });
	  
	  
	  bgUploadInput.addEventListener('change', function (e) {
		    var files = e.target.files;

		    for (var i = 0; i < files.length; i++) {
		      (function (file) {
		        var reader = new FileReader();
		        reader.onload = function (e) {
		          var img = new Image();
		          img.src = e.target.result;
		          img.style.maxHeight = '100px';
		          img.onclick = function () {
		            // ì´ë¯¸ì§€ í´ë¦­ ì‹œ Canvasì— ì¶”ê°€
		        	 setCanvasBackground(img);
		          };
		          bgContainer.appendChild(img);
		        };
		        reader.readAsDataURL(file);
		      })(files[i]);
		    }
		  });
	  
	  function toggleDrawingMode() {
		  isDrawingMode = !isDrawingMode;
		  if (isDrawingMode) {
		    // ê·¸ë¦¬ê¸° ëª¨ë“œê°€ í™œì„±í™”ë˜ë©´ ë§ˆìš°ìŠ¤ë¡œ ê·¸ë¦¼ì„ ê·¸ë¦´ ìˆ˜ ìˆë„ë¡ ì„¤ì •
		    canvas.isDrawingMode = true;
		  } else {
		    // ê·¸ë¦¬ê¸° ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ë©´ ê·¸ë¦¬ê¸° ëª¨ë“œë¥¼ í•´ì œ
		    canvas.isDrawingMode = false;
		  }
		}

		// ê·¸ë¦¬ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
		document.getElementById('start-drawing-button').addEventListener('click', function () {
		  toggleDrawingMode();
		});
	  
		document.getElementById('reset-button').addEventListener('click', function () {
		    // ì‚¬ìš©ìì—ê²Œ í™•ì¸ ë©”ì‹œì§€ í‘œì‹œ
		    var confirmReset = confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ í˜„ì¬ê¹Œì§€ì˜ ê·¸ë¦¼ì„ ëª¨ë‘ ì§€ìš°ê³  ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤.");

		    // ì‚¬ìš©ìê°€ "ì˜ˆ"ë¥¼ ì„ íƒí•œ ê²½ìš°ì—ë§Œ ì´ˆê¸°í™” ì‹¤í–‰
		    if (confirmReset) {
		        // canvasë¥¼ ì™„ì „íˆ ë¹„ìš°ê¸°
		        canvas.clear();
		    }
		});
	  
		// ì´ì „ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
		prevButton.addEventListener('click', function () {
		    undo();
		});
		// ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
		nextButton.addEventListener('click', function () {
		    redo();
		});
		

		// canvas ìƒíƒœë¥¼ ìŠ¤íƒì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜ (ì´ì „ ìƒíƒœ ê¸°ë¡)
		function saveCanvasState() {
		    var currentState = JSON.stringify(canvas.toDatalessJSON()); // í˜„ì¬ canvas ìƒíƒœë¥¼ ë¬¸ìì—´ë¡œ ì €ì¥
		    undoStack.push(currentState); // ìŠ¤íƒì— í˜„ì¬ ìƒíƒœ ì €ì¥
		    // ë‹¤ìŒ í–‰ë™ ìŠ¤íƒ ë¹„ìš°ê¸°
		    redoStack.length = 0;
		    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
		    updateButtonState();
		}

		// canvasì— ë³€í™”ê°€ ìˆì„ ë•Œë§ˆë‹¤ ìƒíƒœë¥¼ ìŠ¤íƒì— ì €ì¥
		canvas.on('object:modified', saveCanvasState);
		canvas.on('object:removed', saveCanvasState);

		// ì´ˆê¸° ìƒíƒœì—ì„œëŠ” ì´ì „ ë²„íŠ¼ê³¼ ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”
		updateButtonState();

		// ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
		function updateButtonState() {
		    // ì´ì „ ë²„íŠ¼ ë¹„í™œì„±í™” ì¡°ê±´: undoStackì´ ë¹„ì–´ ìˆì„ ë•Œ
		    prevButton.disabled = undoStack.length === 0;
		    // ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™” ì¡°ê±´: redoStackì´ ë¹„ì–´ ìˆì„ ë•Œ
		    nextButton.disabled = redoStack.length === 0;
		}
	  
	  
	  
	  
	  
	  document.getElementById('save-jpg-button').onclick = function() {
		    var dataURL = canvas.toDataURL({
		      format: 'jpeg',
		      quality: 0.8
		    });
		    var link = document.createElement('a');
		    link.download = 'canvas-image.jpg';
		    link.href = dataURL;
		    link.click();
		};
		
		
		document.getElementById('line-color').addEventListener('input', function (e) {
		    lineColor = e.target.value;
		    if (isDrawingMode) {
		        canvas.freeDrawingBrush.color = lineColor; // í˜„ì¬ ì„  ìƒ‰ìƒ ì—…ë°ì´íŠ¸
		    }
		});

		// ì„  ë‘ê»˜ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
		document.getElementById('line-width').addEventListener('input', function (e) {
		    lineWidth 	= parseInt(e.target.value, 10);
		    if (isDrawingMode) {
		        canvas.freeDrawingBrush.width = lineWidth; // í˜„ì¬ ì„  ë‘ê»˜ ì—…ë°ì´íŠ¸
		    }
		});
	
		
		// ê·¸ë¦¬ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì„¸ë¶€ ë²„íŠ¼ ìƒì„± (ìƒ‰ìƒ, ë‘ê»˜)
		  document.getElementById('start-drawing-button').addEventListener('click', function() {
			    var drawingOptions = new bootstrap.Collapse(document.getElementById('drawing-options'));
			    drawingOptions.toggle();
			  });	 
	});
	
// ì§€ìš°ê°œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
	document.getElementById('eraseBtn').addEventListener('click', function() {
  	ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// ëª¨ë‹¬ì°½ ë³´ì´ê²Œ í•˜ê¸°
document.getElementById('ai-edit__btn').addEventListener('click', function(){
	$(".imageEdit-modal__wrap").css("display","block");
});


//ì´ë¯¸ì§€ í´ë¦­ ìœ„ì¹˜ ì°¾ê¸°
function findPoint(event){
        clickX =event.offsetX;
        clickY =event.offsetY;
   	}
	

</script>

</body>
</html>