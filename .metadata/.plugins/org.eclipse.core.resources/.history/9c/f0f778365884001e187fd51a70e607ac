<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri = "http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri = "http://java.sun.com/jsp/jstl/fmt" %>
<% response.addHeader("Access-Control-Allow-Origin", "*"); %>
<% response.setHeader("Access-Control-Allow-Headers", "orgin, x-requested-with, content-type, accept"); %>
<c:set var ="cpath" value ="${pageContext.request.contextPath}"/>

<!DOCTYPE html>
<html>
<head>
    <title>Ïä§ÏºÄÏπò Ìå®Îìú</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.1/fabric.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>    
    
    <style>
body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
}

#canvas-container {
    /* border: 1px solid #ccc; */
    margin-bottom: 20px;
    margin-top: 150px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.25); 
    border-radius: 5px
}
#image-container {
    display: flex;
    overflow-x: auto;
    
}

#bg-container {
    display: flex;
    overflow-x: auto;
    
}
#start-drawing-button img, #prev-button img , #next-button img , #reset-button img,
#photo-upload-button img, #bg-upload-button img, #text-button img 
{
    max-width: 1.9rem; /* ÏõêÌïòÎäî ÌÅ¨Í∏∞Î°ú Ï°∞Ï†à */
    /* max-height: 30px; */
}




/* ÏÉÅÎã®Î∞î css */

/* .div-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
  max-width: 100%;
  /* max-height: 100%;
  heigth: auto;  
  background-color: #fffefd;
} */

.view {
  position: absolute;
  /* width: 1920px; */
  width: 100%;
  height: 96px;
  top: 0;
  left: 0;
}

.overlap {
  position: relative;
  width: 100%;
  height: 100%;
}

.group {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
}

.overlap-group {
  position: relative;
  width: 100%;
  height: 100%;
  background-color: #fffefd;
  box-shadow: 0px 2px 12px #0000001a;
}

.text-wrapper {
  position: absolute;
  top: 19px;
  left: 60px;
  font-family: "Noto Sans CJK KR-Bold", Helvetica;
  font-weight: 700;
  color: #242424;
  font-size: 40px;
  letter-spacing: 0;
  line-height: normal;
  text-decoration: underline;
}

#head-div .div {
  position: absolute;
  top: 34px;
  left: 259px;
  font-family: "AppleSDGothicNeoB00-Regular", Helvetica;
  font-weight: 400;
  color: #898989;
  font-size: 20px;
  letter-spacing: 0;
  line-height: normal;
}

.text-wrapper-2 {
  position: absolute;
  top: 34px;
  left: 499px;
  font-family: "AppleSDGothicNeoM00-Regular", Helvetica;
  font-weight: 400;
  color: #fba21d;
  font-size: 20px;
  letter-spacing: 0;
  line-height: normal;
}

.line {
  position: absolute;
  width: 1px;
  height: 20px;
  top: 39px;
  left: 479px;
  object-fit: cover;
}

.group-wrapper {
  position: absolute;
  width: 142px;
  height: 48px;
  top: 24px;
  left: 1718px;
  background-color: #fba21d;
  border-radius: 12px;
  box-shadow: 0px 0px 8px #0000001a;
}

.group-2 {
  position: relative;
  width: 66px;
  height: 24px;
  top: 12px;
  left: 39px;
}

#head-div .img {
  position: absolute;
  width: 24px;
  height: 24px;
  top: 0;
  left: 0;
}

.text-wrapper-3 {
  position: absolute;
  top: 2px;
  left: 38px;
  font-family: "Noto Sans CJK KR-Bold", Helvetica;
  font-weight: 700;
  color: #ffffff;
  font-size: 14px;
  text-align: center;
  letter-spacing: 0;
  line-height: normal;
}

.group-3 {
  position: absolute;
  width: 155px;
  height: 48px;
  top: 24px;
  left: 1369px;
  background-color: #fffffd;
  border-radius: 12px;
  box-shadow: 0px 0px 8px #0000001a;
}

.group-4 {
  position: relative;
  width: 92px;
  height: 24px;
  top: 12px;
  left: 32px;
}

.text-wrapper-4 {
  position: absolute;
  top: 2px;
  left: 38px;
  font-family: "Noto Sans CJK KR-Bold", Helvetica;
  font-weight: 700;
  color: #363636;
  font-size: 14px;
  text-align: center;
  letter-spacing: 0;
  line-height: normal;
}

.group-5 {
  position: absolute;
  width: 154px;
  height: 48px;
  top: 24px;
  left: 1544px;
  background-color: #fffffd;
  border-radius: 12px;
  box-shadow: 0px 0px 8px #0000001a;
}

.group-6 {
  position: relative;
  width: 105px;
  height: 24px;
  top: 12px;
  left: 25px;
}




/* Ìé∏Ïßë Ìà¥ css */
button#start-drawing-button,
button#prev-button,
button#next-button,
button#reset-button,
button#text-button {
	border: 0px;
	background-color: white;
	margin: 0 1em;
}

div#edit-tool {
	text-align: center;
}

.drwaing-tool {
	display: flex;
	flex-direction: row;
	justify-content: center;
	margin-top: 1.5em;
	margin-bottom: 1.5em;
}

.line-color-div{
	margin-right: 1em;
}

.line-width-div{
	margin-left: 1em;
}

/*AI Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞ MODAL*/

.imageEdit-modal{
	display:flex;
	align-items: center;
	width: 33%;
}



</style>
</head>
<body>

   
    <header id="head-div">    
	      <div class="view">
	        <div class="overlap">
	          <div class="group">
	            <div class="overlap-group">
	              <div class="text-wrapper"><a href="${cpath}//">D.A.Y</a></div>
	              <div class="div">ÏãúÏ¶åÏù¥ ÏßÄÎÇòÍ≥† ÎÇòÎì§Ïù¥ üôÑ</div>
	              <div class="text-wrapper-2">16:9 1920px*1080px</div>
	              <img class="line" src="img/line-21.svg" />
	            </div>
	          </div>
	          <div class="group-wrapper">
	            <div class="group-2">
	              <img class="img" src="img/image.svg" />
	              <div class="text-wrapper-3">Îì±Î°ù</div>
	            </div>
	          </div>
	          <button class="group-3" id="save-jpg-button">
	            <div class="group-4">
	              <img class="img" src="img/glyph-undefined.svg" />
	              <div class="text-wrapper-4">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</div>
	            </div>
	          </button>
	          <div class="group-5">
	            <div class="group-6">
	              <img class="img" src="img/glyph-undefined-3.svg" />
	              <div class="text-wrapper-4">ÏûÑÏãúÏ†ÄÏû•Ìï®</div>
	            </div>
	          </div>
	        </div>
	      </div>
      </header>
      






<div id="canvas-container">
  <canvas id="main-canvas" width="1000" height="600"></canvas>
</div>




<div class="container">
  
  <br>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs justify-content-center" role="tablist">
    <li class="nav-item">
      <a class="nav-link active text-danger font-weight-bold" data-toggle="tab" href="#home">ÏÇ¨ÏßÑ</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-warning font-weight-bold" data-toggle="tab" href="#menu1">Î∞∞Í≤Ω</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-info font-weight-bold" data-toggle="tab" href="#menu2">Ïä§Ìã∞Ïª§</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-success font-weight-bold" data-toggle="tab" href="#menu3">Í∑∏Î¶¨Í∏∞</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-primary font-weight-bold" data-toggle="tab" href="#menu4">A.I</a>
    </li>
  </ul>

  <!-- Tab panes -->
  
  
  <div class="tab-content">
    <div id="home" class="container tab-pane active"><br>
      	<div id="image-container">
      	    <div id="photo-upload-button">
		      <img class="add-undefined-glyph" src="img/glyph-undefined.svg" alt="ÏóÖÎ°úÎìú" />
		      <div class="text-wrapper">ÏÇ¨ÏßÑ<br />Í∞ÄÏ†∏Ïò§Í∏∞</div>
		    </div>
<%--     		<div id="photo-upload-button">
			  <img src="${cpath}/resources/editor/upload.png" alt="ÏóÖÎ°úÎìú"><h5>ÏóÖÎ°úÎìú</h5>
			</div> --%>
    		<input type="file" id="image-upload" multiple="multiple" accept="image/*" style= "display: none;">	
  		</div>
    </div>
    <div id="menu1" class="container tab-pane fade"><br>
	   
	   <div id="bg-container">
	    	<div id="bg-upload-button">
			  <img src="${cpath}/resources/editor/upload.png" alt="ÏóÖÎ°úÎìú"><h5>ÏóÖÎ°úÎìú</h5>
			</div>
	    <input type="file" id="background-upload" multiple="multiple" accept="image/*" style= "display: none;">
	    	
	  </div>
    </div>
    
    
    <div id="menu2" class="container tab-pane fade"><br>
      <h3>Ïä§Ìã∞Ïª§</h3>
      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
    </div>
    <div id="menu3" class="container tab-pane fade"><br>
      <div id="edit-tool">
		  <button id="prev-button">
		    <img src="${cpath}/resources/editor/prev.png" alt="Ïù¥Ï†ÑÏúºÎ°ú">
		  </button>
		  <button id="next-button">
		    <img src="${cpath}/resources/editor/next.png" alt="Îã§ÏùåÏúºÎ°ú">
		  </button>
		  <button id="reset-button">
		    <img src="${cpath}/resources/editor/reset.png" alt="Ï¥àÍ∏∞Ìôî">
		  </button>
	      <button id="start-drawing-button">
		    <img src="${cpath}/resources/editor/pencil.png" alt="Í∑∏Î¶¨Í∏∞ Î™®Îìú ÏãúÏûë">
		  </button>
		  <button id="text-button">
		    <img src="${cpath}/resources/editor/txt.png" alt="ÌÖçÏä§Ìä∏">
		  </button>
		  
		  <div class="collapse" id="drawing-options">
		  	<div class="drwaing-tool">
			  <div class="line-color-div"><input type="color" id="line-color" value="#000000"></div>
			  <div class="line-width-div"><input type="range" id="line-width" min="1" max="10" value="2"></div>
			  <div class="controls__btns">
				  <button id="jsErase">ÏßÄÏö∞Í∞ú</button>
				  <input type="range" id="jsRange" min="0.1" max="20.0" step="0.1"/>
			  </div>
		  	</div>
		  </div>
		  
<!-- 		  <label for="font-family">Í∏ÄÍº¥ ÏÑ†ÌÉù:</label>
		    <select id="font-family">
		        <option value="Arial">Arial</option>
		        <option value="Times New Roman">Times New Roman</option>
		        <option value="Courier New">Courier New</option>
		        <option value="Georgia">Georgia</option>
		    </select> -->
      </div>    
    </div>
    <div id="menu4" class="container tab-pane fade"><br>
      <h3>A.I</h3>
      <h3>Î∞∞Í≤Ω Ï†úÍ±∞, Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±, AI ÏßÄÏö∞Í∞ú Îì±ÏùÑ Ï≤¥ÌóòÌï¥Î≥¥ÏÑ∏Ïöî</h3>
      <button id="ai-edit__btn">AIÍ∏∞Îä• ÏÇ¨Ïö©ÌïòÍ∏∞</button>
      
    
         
         
         
<div class ="imageEdit-modal__wrap">
	 <!-- Ïù¥ÎØ∏ÏßÄ Ìé∏Ïßë ÌîåÎùºÏä§ÌÅ¨ -->
       <div class="ai-imgEdit">
      <!-- removeBg -->
         <div class="imageEdit-removeBg">
            <span class="imageEdit-removeBg__span">Î∞∞Í≤Ω Ï†úÍ±∞</span>
            <form id="imageEdit-removeBg__form" 
            method= "post" enctype ="multipart/form-data">
               <input type ="file" name ="myfile" id="uploadFile_notEdited">
               <input type ="submit" id="imageEdit-removeBg__sub" value="Î∞∞Í≤ΩÏ†úÍ±∞ÌïòÍ∏∞">
            </form>
         </div>
      <!-- imageGenerator ÏÉùÏÑ±(Kalo)-->
         <div class="imageEdit-makeImg">
            <span class ="imageEdit-makeImg__span">Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±</span>
            	<form id ="imageEdit-makeImg__form" method ="post">
               <h6>Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏûëÏÑ±ÌïòÏó¨ Ï£ºÏãúÍ≥†, ÏòÅÏñ¥Î°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî</h6>
               <input type ="text" name ="prompt" placeholder="ÏÉùÏÑ±Ìï† Ïù¥ÎØ∏ÏßÄÏùò ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî"><!-- ÏÉùÏÑ±Ìï† Ïù¥ÎØ∏ÏßÄ ÌÖçÏä§Ìä∏ --><br>
               <span class ="makeImg-style">ÏõêÌïòÎäî Ïä§ÌÉÄÏùº</span>
               <select name="art_style" id="art_style">
                  <option value="">ÏÑ†ÌÉù ÏïàÌï®</option>
                  <option value="by Renoir">Î•¥ÎàÑÏïÑÎ•¥ Ïä§ÌÉÄÏùº</option>
                  <option value="by Picasso">ÌîºÏπ¥ÏÜå Ïä§ÌÉÄÏùº</option>
                  <option value="by Gogh">Í≥†Ìùê Ïä§ÌÉÄÏùº</option>
                  <option value="Anime">Ïï†ÎãàÎ©îÏù¥ÏÖò Ïä§ÌÉÄÏùº</option>
                  <option value="cartoon">Ïπ¥Ìà∞ Ïä§ÌÉÄÏùº</option>
               </select>
               <br>
               <input type ="text" name ="negative_prompt"> <!-- Ïù¥ÎØ∏ÏßÄÏóêÏÑú ÏÉùÏÑ±ÌïòÍ≥† Ïã∂ÏßÄ ÏïäÏùÄ ÏöîÏÜå -->
               <span>- ÏÉùÏÑ±Ïãú Ï†úÍ±∞Ìï† ÏöîÏÜå</span>
               <input type ="submit" id="imageEdit-makeImg__sub" value="Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±ÌïòÍ∏∞">
            	</form>
         	</div>
         </div>
	<div class= "imageEdit-modal imageEdit-modal__removeBg">
	   <img id= "basic_image__remBg" src="" alt="Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ"> <!--Ìù∞ÏÉâÎßå ÏûàÍ±∞ÎÇò Ìà¨Î™ÖÌïú Ïù¥ÎØ∏ÏßÄ ÌïòÎÇòÍ∞ÄÏ†∏ÏôÄÏÑú ÎùÑÏö∞Í∏∞-->
	   <span>Î∞∞Í≤Ω Ï†úÍ±∞ Ïù¥ÎØ∏ÏßÄ ÌÖåÏä§Ìä∏</span>
	</div>
	<div class ="imageEdit-modal imageEdit-modal__makedImg">
	   <img id= "basic_image__makeImg" src="" alt="Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ"> <!--Ìù∞ÏÉâÎßå ÏûàÍ±∞ÎÇò Ìà¨Î™ÖÌïú Ïù¥ÎØ∏ÏßÄ ÌïòÎÇòÍ∞ÄÏ†∏ÏôÄÏÑú ÎùÑÏö∞Í∏∞-->
	   <span>ÎßåÎì§Ïñ¥ÏßÑ Ïù¥ÎØ∏ÏßÄ ÌÖåÏä§Ìä∏</span> 
	</div>
	
	<div class= "imageEdit-modal imageEdit-modal__aiEraser">
	   <!-- ÏÇ¨Ïö©ÏûêÍ∞Ä Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÎèÑÎ°ù input ÌÉúÍ∑∏ Ï∂îÍ∞Ä -->
	   <input type="file" id="imageUpload" accept="image/*">
	   <img id="modal-userImg__unerased" src="${cpath}/resources/img/header-bg.jpg" onclick= "findPoint(event)" style="display: none;">
	</div>
</div>
         
         
    </div>
  </div>
</div>




<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
<script>


//ajax Î∂ÄÎ∂Ñ
$(document).ready(function(){
    // Ïù¥ÎØ∏ÏßÄ Î∞∞Í≤Ω Ï†úÍ±∞ Í∏∞Îä• Ï≤òÎ¶¨
    $("#imageEdit-removeBg__form").on('submit',function(e){	
        e.preventDefault(); // Ìèº Ï†úÏ∂ú Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Î∞©ÏßÄ
        var removeBg_fData = new FormData(this); // Ìèº Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±	        
      	console.log(removeBg_fData); 
      	//Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÌõÑ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Í≤å ÌïòÍ∏∞
    $("#uploadFile_notEdited").change(function(){
       var reader = new FileReader();
       reader.onload = function(e){
        UnerasedImg.attr('src', e.target.result).show();
        }
       reader.readAsDataURL(this.files[0]);
    	});
    });
   
      
      
      	
        // AJAX ÏöîÏ≤≠ ÏÑ§Ï†ï Î∞è Ï†ÑÏÜ°
        $.ajax({
            url:'http://localhost:5000/removeBg', // ÏöîÏ≤≠ URL
            type: "post", // HTTP ÏöîÏ≤≠ Î∞©Ïãù
            encytpe: "multipart/form-data",
            cache:false,
            data: removeBg_fData, // Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞
            contentType: false, // Ïª®ÌÖêÌä∏ ÌÉÄÏûÖ ÏÑ§Ï†ï Î∞©ÏßÄ
            processData: false, // Îç∞Ïù¥ÌÑ∞Î•º ÏøºÎ¶¨ Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò Î∞©ÏßÄ
            success: function(data) { // ÏöîÏ≤≠ ÏÑ±Í≥µ Ïãú Ï≤òÎ¶¨Ìï† Ìï®Ïàò
                uploadRemovedImg(data);// Î∞∞Í≤ΩÏù¥ Ï†úÍ±∞Îêú Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ìï®Ïàò Ìò∏Ï∂ú
            },
            error: function(xhr, status, error){ // ÏöîÏ≤≠ Ïã§Ìå® Ïãú Ï≤òÎ¶¨Ìï† Ìï®Ïàò
                alert('Error: ' + error); // Ïò§Î•ò Î©îÏãúÏßÄ ÌëúÏãú
            }
        });
    });

    // ÌÖçÏä§Ìä∏ Í∏∞Î∞ò Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Í∏∞Îä• Ï≤òÎ¶¨
    $("#imageEdit-makeImg__form").on('submit',function(e){
        e.preventDefault(); // Ìèº Ï†úÏ∂ú Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Î∞©ÏßÄ
        var promptValue = $("input[name='prompt']").val(); // nameÏù¥ promptÏù∏ input
        var styleValue = $("#art_style option:selected").val(); //artÏä§ÌÉÄÏùºÏóêÏÑú ÏÑ†ÌÉùÎêú Í≤ÉÏùò Î∞∏Î•ò
        //ÏÇºÌï≠Ïó∞ÏÇ∞ÏûêÎ°ú Ï≤òÎ¶¨
        var combinedPrompt = promptValue + (styleValue ? ", " + styleValue : "");
        
        var makeImg_fData = new FormData(this);
        makeImg_fData.set("prompt", combinedPrompt); // Î≥¥ÎÇº Í∞ùÏ≤¥Î•º Ï†Ä Í≤∞Ìï©Ìïú Îç∞Ïù¥ÌÑ∞Î•º Î∞îÌÉïÏúºÎ°ú Ï≤òÎ¶¨

        // AJAX ÏöîÏ≤≠ ÏÑ§Ï†ï Î∞è Ï†ÑÏÜ°
        $.ajax({
            url:'http://localhost:5000/makeImg', // ÏöîÏ≤≠ URL
            type: "post", // HTTP ÏöîÏ≤≠ Î∞©Ïãù
            data: makeImg_fData, // Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞
            contentType: false, // Ïª®ÌÖêÌä∏ ÌÉÄÏûÖ ÏÑ§Ï†ï Î∞©ÏßÄ
            processData: false, // Îç∞Ïù¥ÌÑ∞Î•º ÏøºÎ¶¨ Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò Î∞©ÏßÄ
            
            success: function(data){ 
            	uploadMakedImg(data)
            },
            error: function(xhr, status, error){ // ÏöîÏ≤≠ Ïã§Ìå® Ïãú Ï≤òÎ¶¨Ìï† Ìï®Ïàò
                alert('Error: ' + error); // Ïò§Î•ò Î©îÏãúÏßÄ ÌëúÏãú
            }
        });
    });
   // AI ÏßÄÏö∞Í∞ú Í∏∞Îä•
      var UnerasedImg = $("#modal-userImg__unerased") // UnerasedImgÎäî Ïú†Ï†ÄÍ∞Ä Ïò¨Î¶∞ ÏÇ¨ÏßÑ
      var clickX, clickY; // ÌÅ¥Î¶≠ ÏúÑÏπò Ï†ÄÏû•ÏùÑ ÏúÑÌïú Ï†ÑÏó≠ Î≥ÄÏàò
      
     
      //Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÌõÑ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Í≤å ÌïòÍ∏∞
      $("#imageUpload").change(function(){
        var reader = new FileReader();
        reader.onload = function(e){
            UnerasedImg.attr('src', e.target.result).show();
        }
        reader.readAsDataURL(this.files[0]);
    });
      
      // Ïù¥ÎØ∏ÏßÄÏôÄ ÏúÑÏπò Îç∞Ïù¥ÌÑ∞Î•º ÏÑúÎ≤ÑÏóê Ï†ÑÏÜ°
      $(#"imageEdit-removeBg__form").on("submit",function(e){
    	  e.preventDefault(); // Ìèº Ï†úÏ∂ú Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏ Î∞©ÏßÄ
      	var formData = new FormData(this);
        formData.append('image', $("#imageUpload")[0].files[0]);
        formData.append('x', clickX);
        formData.append('y', clickY);
        $.ajax({   
            url:"http://localhost:5000/remove_object", //ÏöîÏ≤≠ url remove_objectÏúºÎ°ú Î≥¥ÎÇ¥Í≥†
            type: "post",
            encytpe: "multipart/form-data",
            data: formData,
            processData: false,
            contentType: false,
            success: function(data){
           	 uploadErasedImg(data);
            },
            error: alert("Error")
            
         });
        
      });

});

// Î∞∞Í≤ΩÏù¥ Ï†úÍ±∞Îêú Ïù¥ÎØ∏ÏßÄÎ•º Î™®Îã¨Ïóê ÌëúÏãúÌïòÎäî Ìï®Ïàò
function uploadRemovedImg(data){
   console.log(data)
   var imageUrl = data.image_url;
    $(".imageEdit-modal__removeBg").append('<img id="bg-removedImg" src="'+imageUrl+'" />');
}

// ÏÉùÏÑ±Îêú Ïù¥ÎØ∏ÏßÄÎ•º Î™®Îã¨Ïóê ÌëúÏãúÌïòÎäî Ìï®Ïàò -> Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄÏùò hrefÎ•º Î∞îÍøîÏ£ºÍ∏∞
function uploadMakedImg(data){
   	console.log(data);   
    var makedImg = data.image_url; //image_urlÎ°ú Ìï†Í≤É
    console.log(makedImg); //Ïù¥ÎØ∏ÏßÄ url ÌôïÏù∏
    $('#basic_image__makeImg').attr('src', makedImg); //src Î≥ÄÍ≤ΩÌïòÍ∏∞

}
function uploadErasedImg(data){	
	var erasedImg = data.image_url;
	console.log(erasedImg); // Ïù¥ÎØ∏ÏßÄ urlÎ≥¥ÎÇºÍ≤É Ïó¨Í∏∞ÏÑ† ÏûêÎ∞î Ï†àÎåÄ Í≤ΩÎ°ú;
	$('#basic_image_') //TODO
	
}






document.addEventListener('DOMContentLoaded', function () {
	  const canvas = new fabric.Canvas('main-canvas');	  
	  const ctx = canvas.getContext("2d");
	  var imageContainer = document.getElementById('image-container');
	  var uploadInput = document.getElementById('image-upload');
	  var propertiesPanel = document.getElementById('properties-panel'); // Ìé∏Ïßë ÏòµÏÖòÏùÑ Îã¥ÏùÄ Ìå®ÎÑêÏùò ID
	  var photoButton = document.getElementById('photo-button');
	  var backgroundButton = document.getElementById('background-button');
	  var bgContainer = document.getElementById('bg-container');
	  var bgUploadInput = document.getElementById('background-upload');
	  var isDrawingMode = false;
	  var undoStack = [];
	  var redoStack = [];
	  var prevButton = document.getElementById('prev-button');
	  var nextButton = document.getElementById('next-button'); // Îã§Ïùå Î≤ÑÌäº ÏöîÏÜå Í∞ÄÏ†∏Ïò§Í∏∞
	  var textButton = document.getElementById('text-button'); // ÌÖçÏä§Ìä∏ Î≤ÑÌäº ÏöîÏÜå Í∞ÄÏ†∏Ïò§Í∏∞
	  var isTextMode = false; // ÌÖçÏä§Ìä∏ Î™®Îìú ÏÉÅÌÉú Î≥ÄÏàò
	  var activeText = null;
	  
	  // ÏßÄÏö∞Í∞ú
	  const erase = document.getElementById("jsErase");
	  const erase_range = document.getElementById("jsRange");
	  
	
	  
	  
	// ÌÖçÏä§Ìä∏ ÎèÑÍµ¨ ÌôúÏÑ±Ìôî Ìï®Ïàò
	  function enableTextMode() {
	      isTextMode = true;
	      canvas.discardActiveObject(); // ÏÑ†ÌÉùÎêú Í∞ùÏ≤¥ Ï∑®ÏÜå
	      canvas.requestRenderAll();
	      activeText = null; // ÏÉàÎ°úÏö¥ ÌÖçÏä§Ìä∏ ÏÉÅÏûê ÏÉùÏÑ±ÏùÑ ÏúÑÌï¥ activeText Ï¥àÍ∏∞Ìôî
	  }

	  // ÌÖçÏä§Ìä∏ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
	  textButton.addEventListener('click', function () {
	      enableTextMode();
	  });

	  // Ï∫îÎ≤ÑÏä§ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
	  canvas.on('mouse:down', function (options) {
    if (isTextMode) {
        var pointer = canvas.getPointer(options.e);
        if (!activeText) {
            // ÌôúÏÑ±ÌôîÎêú ÌÖçÏä§Ìä∏ ÏÉÅÏûêÍ∞Ä ÏóÜÏùÑ ÎïåÎßå ÏÉàÎ°úÏö¥ ÌÖçÏä§Ìä∏ ÏÉÅÏûê ÏÉùÏÑ±
            activeText = new fabric.Textbox('ÌÖçÏä§Ìä∏ ÏûÖÎ†•', {
                left: pointer.x,
                top: pointer.y,
                fontFamily: 'Arial',
                fill: 'black',
            });
            canvas.add(activeText);
            canvas.setActiveObject(activeText);
            canvas.requestRenderAll();
        }
    } else {
        // ÌÖçÏä§Ìä∏ Î™®ÎìúÍ∞Ä ÏïÑÎãê Îïå, Îã§Î•∏ ÏûëÏóÖ ÏàòÌñâ
    }
    
    // ÌÖçÏä§Ìä∏ Î™®Îìú ÎπÑÌôúÏÑ±Ìôî
    disableTextMode();
});

	  // ÌÖçÏä§Ìä∏ ÏûÖÎ†• Î™®Îìú ÎπÑÌôúÏÑ±Ìôî Ìï®Ïàò
	  function disableTextMode() {
	      isTextMode = false;
	      activeText = null; // ÌôúÏÑ±ÌôîÎêú ÌÖçÏä§Ìä∏ ÏÉÅÏûê Ï¥àÍ∏∞Ìôî
	  }

	  // Ï∫îÎ≤ÑÏä§ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨: ÌÖçÏä§Ìä∏ Î™®Îìú ÎπÑÌôúÏÑ±Ìôî
	  canvas.on('mouse:down', function () {
	      disableTextMode();
	  });
	      
/* 	// Í∏ÄÍº¥ ÏÑ†ÌÉùÎûÄ ÏóòÎ¶¨Î®ºÌä∏ÏôÄ ÌÖçÏä§Ìä∏Î•º Î≥ÄÍ≤ΩÌï† ÏóòÎ¶¨Î®ºÌä∏Î•º Í∞ÄÏ†∏ÏòµÎãàÎã§.
	  const fontSelect = document.getElementById('font-family');

	  // Í∏ÄÍº¥ ÏÑ†ÌÉùÎûÄÏùò Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏Î•º Í∞êÏßÄÌï©ÎãàÎã§.
	  fontSelect.addEventListener('change', function () {
	      if (isTextMode && activeText) {
	          // ÏÑ†ÌÉùÌïú Í∏ÄÍº¥ Í∞íÏùÑ Í∞ÄÏ†∏ÏòµÎãàÎã§.
	          const selectedFont = fontSelect.value;

	          // ÌôúÏÑ±ÌôîÎêú ÌÖçÏä§Ìä∏ ÏÉÅÏûêÏóê ÏÑ†ÌÉùÌïú Í∏ÄÍº¥ÏùÑ Ï†ÅÏö©Ìï©ÎãàÎã§.
	          activeText.set({ fontFamily: selectedFont });
	          canvas.requestRenderAll();
	      }
	  }); */

		
	  
	// ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
	  document.getElementById('photo-upload-button').addEventListener('click', function () {
	      // ÌååÏùº ÏóÖÎ°úÎìú Î≤ÑÌäº ÌÅ¥Î¶≠
	      document.getElementById('image-upload').click();
	  });
	  document.getElementById('bg-upload-button').addEventListener('click', function () {
	      // ÌååÏùº ÏóÖÎ°úÎìú Î≤ÑÌäº ÌÅ¥Î¶≠
	      document.getElementById('background-upload').click();
	  });
	  
	  
	  // Ïù¥ÎØ∏ÏßÄÎ•º CanvasÏóê Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
	  function addImageToCanvas(imgElement) {
	    fabric.Image.fromURL(imgElement.src, function (oImg) {
	      canvas.add(oImg).renderAll();
	      // Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌïòÎ©¥ Ìé∏Ïßë ÏòµÏÖò Ìå®ÎÑêÏùÑ ÌëúÏãú
	      propertiesPanel.style.display = 'block';
	      // ÏÑ†ÌÉùÎêú Í∞ùÏ≤¥Ïùò ÏÜçÏÑ±ÏùÑ Ìå®ÎÑêÏóê ÌëúÏãúÌï† Ïàò ÏûàÏäµÎãàÎã§.
	      // Ïòà: propertiesPanel.querySelector('.width').textContent = oImg.getScaledWidth();
	    });
	  }
		//Î∞∞Í≤ΩÏù¥ÎØ∏ÏßÄÎ°ú Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
		function setCanvasBackground(imgElement) {
			var img = new Image();
		    img.src = imgElement.src;

		    img.onload = function () {
		        canvas.setBackgroundImage(imgElement.src, canvas.renderAll.bind(canvas), {
		            scaleX: canvas.width / img.width,
		            scaleY: canvas.height / img.height,
		            top: 0,
		            left: 0
		        });
		    };
		}
		// Ïù¥Ï†ÑÏúºÎ°ú ÎèåÏïÑÍ∞ÄÎäî Ìï®Ïàò
		function undo() {
		    if (undoStack.length > 0) {
		        var previousState = undoStack.pop(); // Ïä§ÌÉùÏóêÏÑú Ïù¥Ï†Ñ ÏÉÅÌÉúÎ•º Ìåù
		        redoStack.push(JSON.stringify(canvas.toDatalessJSON())); // ÌòÑÏû¨ ÏÉÅÌÉúÎ•º Îã§Ïùå ÌñâÎèô Ïä§ÌÉùÏóê Ï†ÄÏû•
		        canvas.loadFromJSON(previousState); // Ïù¥Ï†Ñ ÏÉÅÌÉúÎ°ú canvas Î≥µÏõê
		        canvas.renderAll(); // canvas Îã§Ïãú Í∑∏Î¶¨Í∏∞
		    }
		    // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
		    updateButtonState();
		}

		// Îã§ÏùåÏúºÎ°ú Ïù¥ÎèôÌïòÎäî Ìï®Ïàò
		function redo() {
		    if (redoStack.length > 0) {
		        var nextState = redoStack.pop(); // Ïä§ÌÉùÏóêÏÑú Îã§Ïùå ÏÉÅÌÉúÎ•º Ìåù
		        undoStack.push(JSON.stringify(canvas.toDatalessJSON())); // ÌòÑÏû¨ ÏÉÅÌÉúÎ•º Ïù¥Ï†Ñ ÌñâÎèô Ïä§ÌÉùÏóê Ï†ÄÏû•
		        canvas.loadFromJSON(nextState); // Îã§Ïùå ÏÉÅÌÉúÎ°ú canvas Î≥µÏõê
		        canvas.renderAll(); // canvas Îã§Ïãú Í∑∏Î¶¨Í∏∞
		    }
		    // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
		    updateButtonState();
		}

		
		
	  
		bgContainer.addEventListener('click', function (e) {
		    var clickedImage = e.target;
		    // ÌÅ¥Î¶≠Ìïú Ïù¥ÎØ∏ÏßÄÎ•º canvasÏùò Î∞∞Í≤ΩÏúºÎ°ú ÏÑ§Ï†ï
		    setCanvasBackground(clickedImage);
		});

		// Ïù¥ÎØ∏ÏßÄÎ•º CanvasÏóê Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò (Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞ÄÏôÄ Î∞∞Í≤Ω ÏÑ§Ï†ïÏùÑ Î∂ÑÎ¶¨)
		function addImageToCanvas(imgElement) {
		    fabric.Image.fromURL(imgElement.src, function (oImg) {
		        canvas.add(oImg).renderAll();
		        // Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ†ÌÉùÌïòÎ©¥ Ìé∏Ïßë ÏòµÏÖò Ìå®ÎÑêÏùÑ ÌëúÏãú
		        propertiesPanel.style.display = 'block';
		        // ÏÑ†ÌÉùÎêú Í∞ùÏ≤¥Ïùò ÏÜçÏÑ±ÏùÑ Ìå®ÎÑêÏóê ÌëúÏãúÌï† Ïàò ÏûàÏäµÎãàÎã§.
		        // Ïòà: propertiesPanel.querySelector('.width').textContent = oImg.getScaledWidth();
		    });
		}

		
		
	  uploadInput.addEventListener('change', function (e) {
	    var files = e.target.files;
	   

	    for (var i = 0; i < files.length; i++) {
	      (function (file) {
	        var reader = new FileReader();
	        reader.onload = function (e) {
	          var img = new Image();
	          img.src = e.target.result;
	          img.style.maxHeight = '100px';
	          img.onclick = function () {
	            // Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ Ïãú CanvasÏóê Ï∂îÍ∞Ä
	            addImageToCanvas(img);
	          };
	          imageContainer.appendChild(img);
	        };
	        reader.readAsDataURL(file);
	      })(files[i]);
	    }
	  });
	  
	  
	  bgUploadInput.addEventListener('change', function (e) {
		    var files = e.target.files;

		    for (var i = 0; i < files.length; i++) {
		      (function (file) {
		        var reader = new FileReader();
		        reader.onload = function (e) {
		          var img = new Image();
		          img.src = e.target.result;
		          img.style.maxHeight = '100px';
		          img.onclick = function () {
		            // Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ Ïãú CanvasÏóê Ï∂îÍ∞Ä
		        	 setCanvasBackground(img);
		          };
		          bgContainer.appendChild(img);
		        };
		        reader.readAsDataURL(file);
		      })(files[i]);
		    }
		  });
	  
	  function toggleDrawingMode() {
		  isDrawingMode = !isDrawingMode;
		  if (isDrawingMode) {
		    // Í∑∏Î¶¨Í∏∞ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÎ©¥ ÎßàÏö∞Ïä§Î°ú Í∑∏Î¶ºÏùÑ Í∑∏Î¶¥ Ïàò ÏûàÎèÑÎ°ù ÏÑ§Ï†ï
		    canvas.isDrawingMode = true;
		  } else {
		    // Í∑∏Î¶¨Í∏∞ Î™®ÎìúÍ∞Ä ÎπÑÌôúÏÑ±ÌôîÎêòÎ©¥ Í∑∏Î¶¨Í∏∞ Î™®ÎìúÎ•º Ìï¥Ï†ú
		    canvas.isDrawingMode = false;
		  }
		}

		// Í∑∏Î¶¨Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
		document.getElementById('start-drawing-button').addEventListener('click', function () {
		  toggleDrawingMode();
		});
	  
		document.getElementById('reset-button').addEventListener('click', function () {
		    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÌôïÏù∏ Î©îÏãúÏßÄ ÌëúÏãú
		    var confirmReset = confirm("Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÌòÑÏû¨ÍπåÏßÄÏùò Í∑∏Î¶ºÏùÑ Î™®Îëê ÏßÄÏö∞Í≥† ÏÉàÎ°ú ÏãúÏûëÌï©ÎãàÎã§.");

		    // ÏÇ¨Ïö©ÏûêÍ∞Ä "Ïòà"Î•º ÏÑ†ÌÉùÌïú Í≤ΩÏö∞ÏóêÎßå Ï¥àÍ∏∞Ìôî Ïã§Ìñâ
		    if (confirmReset) {
		        // canvasÎ•º ÏôÑÏ†ÑÌûà ÎπÑÏö∞Í∏∞
		        canvas.clear();
		    }
		});
	  
		// Ïù¥Ï†Ñ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
		prevButton.addEventListener('click', function () {
		    undo();
		});
		// Îã§Ïùå Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
		nextButton.addEventListener('click', function () {
		    redo();
		});
		

		// canvas ÏÉÅÌÉúÎ•º Ïä§ÌÉùÏóê Ï†ÄÏû•ÌïòÎäî Ìï®Ïàò (Ïù¥Ï†Ñ ÏÉÅÌÉú Í∏∞Î°ù)
		function saveCanvasState() {
		    var currentState = JSON.stringify(canvas.toDatalessJSON()); // ÌòÑÏû¨ canvas ÏÉÅÌÉúÎ•º Î¨∏ÏûêÏó¥Î°ú Ï†ÄÏû•
		    undoStack.push(currentState); // Ïä§ÌÉùÏóê ÌòÑÏû¨ ÏÉÅÌÉú Ï†ÄÏû•
		    // Îã§Ïùå ÌñâÎèô Ïä§ÌÉù ÎπÑÏö∞Í∏∞
		    redoStack.length = 0;
		    // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
		    updateButtonState();
		}

		// canvasÏóê Î≥ÄÌôîÍ∞Ä ÏûàÏùÑ ÎïåÎßàÎã§ ÏÉÅÌÉúÎ•º Ïä§ÌÉùÏóê Ï†ÄÏû•
		canvas.on('object:modified', saveCanvasState);
		canvas.on('object:removed', saveCanvasState);

		// Ï¥àÍ∏∞ ÏÉÅÌÉúÏóêÏÑúÎäî Ïù¥Ï†Ñ Î≤ÑÌäºÍ≥º Îã§Ïùå Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
		updateButtonState();

		// Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
		function updateButtonState() {
		    // Ïù¥Ï†Ñ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Ï°∞Í±¥: undoStackÏù¥ ÎπÑÏñ¥ ÏûàÏùÑ Îïå
		    prevButton.disabled = undoStack.length === 0;
		    // Îã§Ïùå Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Ï°∞Í±¥: redoStackÏù¥ ÎπÑÏñ¥ ÏûàÏùÑ Îïå
		    nextButton.disabled = redoStack.length === 0;
		}
	  
	  
	  
	  
	  
	  document.getElementById('save-jpg-button').onclick = function() {
		    var dataURL = canvas.toDataURL({
		      format: 'jpeg',
		      quality: 0.8
		    });
		    var link = document.createElement('a');
		    link.download = 'canvas-image.jpg';
		    link.href = dataURL;
		    link.click();
		};
		
		
		document.getElementById('line-color').addEventListener('input', function (e) {
		    lineColor = e.target.value;
		    if (isDrawingMode) {
		        canvas.freeDrawingBrush.color = lineColor; // ÌòÑÏû¨ ÏÑ† ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
		    }
		});

		// ÏÑ† ÎëêÍªò Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
		document.getElementById('line-width').addEventListener('input', function (e) {
		    lineWidth 	= parseInt(e.target.value, 10);
		    if (isDrawingMode) {
		        canvas.freeDrawingBrush.width = lineWidth; // ÌòÑÏû¨ ÏÑ† ÎëêÍªò ÏóÖÎç∞Ïù¥Ìä∏
		    }
		});
	
		
		// Í∑∏Î¶¨Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÏÑ∏Î∂Ä Î≤ÑÌäº ÏÉùÏÑ± (ÏÉâÏÉÅ, ÎëêÍªò)
		  document.getElementById('start-drawing-button').addEventListener('click', function() {
			    var drawingOptions = new bootstrap.Collapse(document.getElementById('drawing-options'));
			    drawingOptions.toggle();
			  });	 
	});
	
// ÏßÄÏö∞Í∞ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
	document.getElementById('eraseBtn').addEventListener('click', function() {
  	ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// Î™®Îã¨Ï∞Ω Î≥¥Ïù¥Í≤å ÌïòÍ∏∞
document.getElementById('ai-edit__btn').addEventListener('click', function(){
	$(".imageEdit-modal__wrap").css("display","block");
});


//Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ ÏúÑÏπò Ï∞æÍ∏∞
function findPoint(event){
        clickX =event.offsetX;
        clickY =event.offsetY;
   	}
	

</script>

</body>
</html>